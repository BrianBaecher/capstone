@using Radzen
@using Radzen.Blazor
@using Capstone.Models
@using Capstone.Shared.Models
@inject DestinationService destinationService

<RadzenDataGrid @ref="grid" AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand" AllowPaging="true" PageSize="5" AllowSorting="true"
				Data="@destinations" TItem="Destination">
	<Columns>
		<RadzenDataGridColumn Width="50px" Title="#" Filterable="false" Sortable="false" TextAlign="TextAlign.Center">
			<Template Context="data">
				@(Array.IndexOf(destinations, data) + 1)
			</Template>
		</RadzenDataGridColumn>
		<RadzenDataGridColumn Property="Name" Title="Name">
			<Template Context="destination">
				<RadzenStack Orientation="Radzen.Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center">
					<RadzenImage Path="@destination.GetImageUrl(AppConfigHelper.ApiBaseUrl)" Style="width: 40px; height: 40px;" class="rz-border-radius-2" AlternateText="" />
					<RadzenStack Gap="0">
						<RadzenText TextStyle="TextStyle.Subtitle2" class="rz-mb-0">@destination.Name</RadzenText>
						<RadzenText TextStyle="TextStyle.Caption" class="rz-mb-0">@destination.Name</RadzenText>
					</RadzenStack>
				</RadzenStack>
			</Template>
		</RadzenDataGridColumn>
		<RadzenDataGridColumn Property="PricePerDay" Title="Price/Day" />
		<RadzenDataGridColumn Property="Description" Title="Description">
			<Template Context="destination">
				@destination.Name
			</Template>
		</RadzenDataGridColumn>
		<RadzenDataGridColumn Width="160px" Property="OrderID" Title="Order Details">
			<Template Context="data">
				<RadzenStack>
					<RadzenText TextStyle="TextStyle.Subtitle1">@data.Code</RadzenText>
					<RadzenButton ButtonStyle="ButtonStyle.Warning" Variant="Variant.Flat" Shade="Shade.Lighter" Icon="build" class="rz-m-1" Text="Edit" Click="() => ReportEditSelection(data)" />
				</RadzenStack>
			</Template>
		</RadzenDataGridColumn>
	</Columns>
</RadzenDataGrid>

@code {

	[Parameter]
	public EventCallback<Destination> OnSelection { get; set; }

	RadzenDataGrid<Destination> grid;

	Destination[] destinations = [];

	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();

		destinations = await destinationService.GetAllAsync();
	}

	void Change(string text)
	{
	}

	void ReportEditSelection(Destination d)
	{
		Console.WriteLine($"Chosen to edit {d.Name}");
		OnSelection.InvokeAsync(d);
	}
}
